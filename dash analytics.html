<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dash analytics</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {}
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        .bounce-in { animation: bounceIn 0.6s ease-out; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .hover-lift { transition: all 0.3s ease; }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .notification { animation: slideInRight 0.4s ease-out; }
        .pulse-ring { animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulse-ring { 
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .dark .custom-scrollbar::-webkit-scrollbar-track { background: #374151; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        
        .chart-container { position: relative; height: 250px; width: 100%; }
        .modal-chart-container { position: relative; height: 200px; width: 100%; }
        
        .status-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.35s; }
        
        .floating-action { 
            position: fixed; 
            bottom: 2rem; 
            right: 2rem; 
            z-index: 40;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 transition-all duration-500">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-full w-72 bg-white/80 dark:bg-gray-800/80 glass-effect shadow-2xl z-50 sidebar-transition transform -translate-x-full lg:translate-x-0 border-r border-gray-200/50 dark:border-gray-700/50">
        <div class="p-8 border-b border-gray-200/50 dark:border-gray-700/50">
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-rocket text-white text-lg"></i>
                    </div>
                    <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full pulse-ring"></div>
                </div>
                <div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent">Dash Analytics</h1>
                    <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Vers√£o 2.0</p>
                </div>
            </div>
        </div>
        
        <nav class="mt-8 px-4">
            <a href="#" onclick="showModule('messages')" class="nav-item group flex items-center px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all duration-300 mb-2">
                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-comments text-white"></i>
                </div>
                <div>
                    <span class="font-semibold">Mensagens R√°pidas</span>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Gerencie templates</p>
                </div>
            </a>
            <a href="#" onclick="showModule('dashboard')" class="nav-item group flex items-center px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-all duration-300">
                <div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-tachometer-alt text-white"></i>
                </div>
                <div>
                    <span class="font-semibold">Dashboard Servi√ßos</span>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Controle projetos</p>
                </div>
            </a>
        </nav>
        
        <div class="absolute bottom-8 left-4 right-4">
            <button onclick="toggleTheme()" class="w-full flex items-center justify-center px-6 py-4 bg-gray-100 dark:bg-gray-700 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300 group">
                <div class="w-8 h-8 bg-blue-500 dark:bg-blue-600 rounded-lg flex items-center justify-center mr-3 group-hover:rotate-180 transition-transform duration-500">
                    <i id="theme-icon" class="fas fa-moon text-white text-sm"></i>
                </div>
                <span class="text-gray-700 dark:text-gray-300 font-medium">Alternar Tema</span>
            </button>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="lg:hidden fixed top-6 left-6 z-50 p-3 bg-white/80 dark:bg-gray-800/80 glass-effect rounded-xl shadow-lg hover:scale-110 transition-transform duration-300">
        <i class="fas fa-bars text-gray-700 dark:text-gray-300"></i>
    </button>

    <!-- Main Content -->
    <div class="lg:ml-72 min-h-screen">
        <!-- Header -->
        <header class="bg-white/80 dark:bg-gray-800/80 glass-effect shadow-sm border-b border-gray-200/50 dark:border-gray-700/50 p-6 sticky top-0 z-30">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-2 h-8 bg-gradient-to-b from-blue-500 to-indigo-500 rounded-full"></div>
                    <h2 id="page-title" class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent">Mensagens R√°pidas</h2>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="exportData()" class="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-medium">
                        <i class="fas fa-download mr-2"></i>Backup
                    </button>
                    <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(event)">
                    <button onclick="document.getElementById('import-file').click()" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-medium">
                        <i class="fas fa-upload mr-2"></i>Restaurar
                    </button>
                </div>
            </div>
        </header>

        <!-- Messages Module -->
        <div id="messages-module" class="p-8 fade-in">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total de Mensagens</p>
                            <p id="total-messages" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-message text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Mensagens Copiadas</p>
                            <p id="copied-messages" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-copy text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Com Vari√°veis</p>
                            <p id="variable-messages" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-700 rounded-xl flex items-center justify-center">
                            <i class="fas fa-code text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Tags √önicas</p>
                            <p id="unique-tags" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-800 rounded-xl flex items-center justify-center">
                            <i class="fas fa-tag text-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Message Form -->
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-8 rounded-2xl shadow-lg mb-8 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-plus text-white text-sm"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Nova Mensagem</h3>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">T√≠tulo da Mensagem</label>
                            <input type="text" id="message-title" class="w-full p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" placeholder="Digite um t√≠tulo descritivo">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Tags (separadas por v√≠rgula)</label>
                            <input type="text" id="message-tags" class="w-full p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" placeholder="vendas, suporte, cobran√ßa">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Conte√∫do da Mensagem</label>
                            <textarea id="message-content" rows="8" class="w-full p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 resize-none" placeholder="Ol√° {{cliente}}, como posso ajudar voc√™ hoje?"></textarea>
                        </div>
                        
                        <button onclick="saveMessage()" class="w-full bg-blue-500 text-white py-4 px-6 rounded-xl hover:bg-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold text-lg">
                            <i class="fas fa-save mr-3"></i>Salvar Mensagem
                        </button>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Pr√©-visualiza√ß√£o em Tempo Real</label>
                            <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 min-h-[200px]">
                                <div id="message-preview" class="text-gray-800 dark:text-white whitespace-pre-wrap font-medium">Digite uma mensagem para ver a pr√©-visualiza√ß√£o...</div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Vari√°veis para Teste</label>
                            <div id="variable-inputs" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg mb-8 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1 relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="search-messages" class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" placeholder="Buscar mensagens..." oninput="filterMessages()">
                    </div>
                    <div class="flex-1 relative">
                        <i class="fas fa-filter absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <select id="filter-tag" class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" onchange="filterMessages()">
                            <option value="">Todas as tags</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Messages List -->
            <div id="messages-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"></div>

            <!-- History -->
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-8 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-history text-white text-sm"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Hist√≥rico de Mensagens Copiadas</h3>
                </div>
                <div id="copy-history" class="space-y-4 custom-scrollbar max-h-96 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Dashboard Module -->
        <div id="dashboard-module" class="p-8 fade-in hidden">
            <!-- Service Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total Servi√ßos</p>
                            <p id="total-services" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-tasks text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Pendentes</p>
                            <p id="pending-services" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Em Andamento</p>
                            <p id="progress-services" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-700 rounded-xl flex items-center justify-center">
                            <i class="fas fa-spinner text-white"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Conclu√≠dos</p>
                            <p id="completed-services" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-800 rounded-xl flex items-center justify-center">
                            <i class="fas fa-check text-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Service and Import -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-8 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-plus text-white text-sm"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Novo Servi√ßo</h3>
                    </div>
                    <div class="space-y-6">
                        <input type="text" id="service-name" class="w-full p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" placeholder="Nome do servi√ßo">
                        <textarea id="service-description" rows="3" class="w-full p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 resize-none" placeholder="Descri√ß√£o do servi√ßo"></textarea>
                        
                        <!-- Status Personalizados -->
                        <div class="bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 p-6 rounded-xl border border-indigo-200/50 dark:border-indigo-700/50">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                                    <i class="fas fa-cogs mr-2 text-indigo-500"></i>
                                    Status Personalizados
                                </h4>
                                <button type="button" onclick="addCustomStatus()" class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-indigo-600 hover:to-purple-600 transition-all duration-300 text-sm font-medium">
                                    <i class="fas fa-plus mr-2"></i>Adicionar Status
                                </button>
                            </div>
                            <div id="custom-status-list" class="space-y-3">
                                <!-- Status padr√µes -->
                                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                                    <input type="text" value="Pendente" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                                    <input type="color" value="#F59E0B" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                                    <input type="text" value="Em Andamento" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                                    <input type="color" value="#3B82F6" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                                    <input type="text" value="Conclu√≠do" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                                    <input type="color" value="#10B981" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <p class="text-sm text-blue-800 dark:text-blue-200 flex items-center">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Defina quantos itens cada status ter√°. Os itens ser√£o criados automaticamente!
                                </p>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <div class="flex items-center space-x-3">
                                <label class="text-sm font-semibold text-gray-700 dark:text-gray-300">Cor do Projeto:</label>
                                <input type="color" id="service-color" value="#3B82F6" class="w-12 h-12 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer">
                            </div>
                        </div>
                        <button onclick="saveService()" class="w-full bg-blue-500 text-white py-4 px-6 rounded-xl hover:bg-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                            <i class="fas fa-plus mr-3"></i>Criar Servi√ßo com Status Personalizados
                        </button>
                    </div>
                </div>
                
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-8 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-file-import text-white text-sm"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Importar Dados</h3>
                    </div>
                    <div class="space-y-6">
                        <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <input type="file" id="excel-file" accept=".xlsx,.xls,.csv" class="hidden">
                            <button onclick="document.getElementById('excel-file').click()" class="text-blue-600 dark:text-blue-400 font-semibold hover:underline">
                                Clique para selecionar arquivo
                            </button>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Excel (.xlsx, .xls) ou CSV</p>
                        </div>
                        <button onclick="importExcel()" class="w-full bg-blue-600 text-white py-4 px-6 rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                            <i class="fas fa-file-excel mr-3"></i>Importar Excel/CSV
                        </button>
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                            <p class="text-sm text-blue-800 dark:text-blue-200 font-medium mb-2">
                                <i class="fas fa-info-circle mr-2"></i>
                                Como funciona a importa√ß√£o:
                            </p>
                            <div class="text-xs text-blue-700 dark:text-blue-300 space-y-1">
                                <p><strong>‚Ä¢ Servi√ßo √önico:</strong> Todas as linhas da planilha viram itens de um √∫nico projeto</p>
                                <p><strong>‚Ä¢ Detec√ß√£o Autom√°tica:</strong> Identifica automaticamente colunas de nome, usu√°rio e status</p>
                                <p><strong>‚Ä¢ Status Personalizados:</strong> Cria status baseados nos valores √∫nicos da coluna "Status"</p>
                                <p><strong>‚Ä¢ Todas as Colunas:</strong> Informa√ß√µes extras s√£o inclu√≠das na descri√ß√£o dos itens</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services List -->
            <div id="services-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </div>

    <!-- Service Detail Modal -->
    <div id="service-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-7xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar shadow-2xl border border-gray-200/50 dark:border-gray-700/50">
            <div class="sticky top-0 bg-white/80 dark:bg-gray-800/80 glass-effect p-6 border-b border-gray-200/50 dark:border-gray-700/50 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-project-diagram text-white text-sm"></i>
                    </div>
                    <h2 id="modal-service-name" class="text-2xl font-bold text-gray-800 dark:text-white"></h2>
                </div>
                <button onclick="closeServiceModal()" class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-8">
                <!-- Service Overview -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="space-y-6">
                        <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 p-6 rounded-2xl">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                                Resumo do Projeto
                            </h3>
                            <p id="modal-service-description" class="text-gray-600 dark:text-gray-400 leading-relaxed"></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-flag text-blue-500 mr-2"></i>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</p>
                                </div>
                                <p id="modal-service-status" class="font-bold text-lg text-gray-800 dark:text-white"></p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-list text-green-500 mr-2"></i>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total de Itens</p>
                                </div>
                                <p id="modal-service-items" class="font-bold text-lg text-gray-800 dark:text-white">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-chart-pie mr-2 text-purple-500"></i>
                            Distribui√ß√£o de Status
                        </h3>
                        <div class="modal-chart-container">
                            <canvas id="service-chart"></canvas>
                        </div>
                    </div>
                </div>



                <!-- Items Table -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50 overflow-hidden">
                    <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-table mr-2 text-green-500"></i>
                                Itens do Servi√ßo
                            </h3>
                            <button onclick="exportServicePDF()" class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-xl hover:from-red-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                                <i class="fas fa-file-pdf mr-2"></i>Exportar PDF
                            </button>
                        </div>
                        
                        <!-- Filters -->
                        <div class="flex gap-4">
                            <div class="flex-1 relative">
                                <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="filter-items" class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" placeholder="Buscar itens..." oninput="filterServiceItems()">
                            </div>
                            <select id="filter-item-status" class="p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" onchange="filterServiceItems()">
                                <option value="">Todos os status</option>
                                <option value="pendente">Pendente</option>
                                <option value="andamento">Em Andamento</option>
                                <option value="concluido">Conclu√≠do</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600">
                                <tr>
                                    <th class="p-4 text-left text-gray-800 dark:text-white font-semibold">Nome</th>
                                    <th class="p-4 text-left text-gray-800 dark:text-white font-semibold">Descri√ß√£o</th>
                                    <th class="p-4 text-left text-gray-800 dark:text-white font-semibold">Status</th>
                                    <th class="p-4 text-left text-gray-800 dark:text-white font-semibold">Data</th>
                                    <th class="p-4 text-left text-gray-800 dark:text-white font-semibold">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="service-items-table" class="divide-y divide-gray-200 dark:divide-gray-600">
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagina√ß√£o -->
                    <div id="pagination-container" class="p-6 border-t border-gray-200/50 dark:border-gray-700/50 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <span id="pagination-info" class="text-sm text-gray-600 dark:text-gray-400 font-medium"></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="prev-page" onclick="changePage(currentPage - 1)" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                                    <i class="fas fa-chevron-left mr-2"></i>Anterior
                                </button>
                                <div id="page-numbers" class="flex items-center space-x-1"></div>
                                <button id="next-page" onclick="changePage(currentPage + 1)" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                                    Pr√≥xima<i class="fas fa-chevron-right ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button id="floating-action" class="floating-action w-16 h-16 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-all duration-300 hover:scale-110 hidden lg:flex items-center justify-center" onclick="scrollToTop()">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>

    <!-- Notifications -->
    <div id="notifications" class="fixed top-6 right-6 z-50 space-y-3"></div>

    <script>
        // Global variables
        let currentTheme = localStorage.getItem('theme') || 'light';
        let messages = JSON.parse(localStorage.getItem('messages')) || [];
        let services = JSON.parse(localStorage.getItem('services')) || [];
        let copyHistory = JSON.parse(localStorage.getItem('copyHistory')) || [];
        let currentService = null;
        let serviceChart = null;
        let currentPage = 1;
        let itemsPerPage = 6;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Tema inicial:', currentTheme); // Debug
            applyTheme();
            showModule('messages');
            updateMessageStats();
            renderMessages();
            updateServiceStats();
            renderServices();
            setupMobileMenu();
            setupPreview();
            setupScrollButton();
        });

        // Theme management
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            console.log('Tema alterado para:', currentTheme); // Debug
            applyTheme();
            showNotification(`Tema ${currentTheme === 'dark' ? 'escuro' : 'claro'} ativado!`, 'success');
        }

        function applyTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            // Remover todas as classes de tema primeiro
            html.classList.remove('dark', 'light');
            
            if (currentTheme === 'dark') {
                html.classList.add('dark');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-sun text-white text-sm';
                }
            } else {
                html.classList.add('light');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-moon text-white text-sm';
                }
            }
            
            // For√ßar re-renderiza√ß√£o dos gr√°ficos se existirem
            if (serviceChart) {
                setTimeout(() => {
                    serviceChart.options.plugins.legend.labels.color = currentTheme === 'dark' ? '#E5E7EB' : '#374151';
                    serviceChart.update();
                }, 100);
            }
            
            // For√ßar atualiza√ß√£o visual
            document.body.style.transition = 'all 0.3s ease';
            setTimeout(() => {
                document.body.style.transition = '';
            }, 300);
        }

        // Mobile menu
        function setupMobileMenu() {
            const mobileBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            
            mobileBtn.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            document.addEventListener('click', (e) => {
                if (window.innerWidth < 1024 && !sidebar.contains(e.target) && !mobileBtn.contains(e.target)) {
                    sidebar.classList.add('-translate-x-full');
                }
            });
        }

        // Scroll button
        function setupScrollButton() {
            const floatingBtn = document.getElementById('floating-action');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    floatingBtn.classList.remove('hidden');
                    floatingBtn.classList.add('flex');
                } else {
                    floatingBtn.classList.add('hidden');
                    floatingBtn.classList.remove('flex');
                }
            });
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Module navigation
        function showModule(module) {
            document.getElementById('messages-module').classList.add('hidden');
            document.getElementById('dashboard-module').classList.add('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-gradient-to-r', 'from-blue-50', 'to-indigo-50', 'dark:from-blue-900/20', 'dark:to-indigo-900/20', 'text-blue-600', 'dark:text-blue-400');
            });

            if (module === 'messages') {
                document.getElementById('messages-module').classList.remove('hidden');
                document.getElementById('page-title').textContent = 'Mensagens R√°pidas';
                document.querySelectorAll('.nav-item')[0].classList.add('bg-gradient-to-r', 'from-blue-50', 'to-indigo-50', 'dark:from-blue-900/20', 'dark:to-indigo-900/20', 'text-blue-600', 'dark:text-blue-400');
            } else if (module === 'dashboard') {
                document.getElementById('dashboard-module').classList.remove('hidden');
                document.getElementById('page-title').textContent = 'Dashboard de Servi√ßos';
                document.querySelectorAll('.nav-item')[1].classList.add('bg-gradient-to-r', 'from-purple-50', 'to-purple-100', 'dark:from-purple-900/20', 'dark:to-purple-800/20', 'text-purple-600', 'dark:text-purple-400');
            }

            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
            }
        }

        // Messages Module Functions
        function setupPreview() {
            const contentInput = document.getElementById('message-content');
            contentInput.addEventListener('input', updatePreview);
        }

        function updatePreview() {
            const content = document.getElementById('message-content').value;
            const preview = document.getElementById('message-preview');
            const variableInputs = document.getElementById('variable-inputs');
            
            const variables = content.match(/\{\{([^}]+)\}\}/g) || [];
            const uniqueVars = [...new Set(variables.map(v => v.slice(2, -2)))];
            
            variableInputs.innerHTML = '';
            uniqueVars.forEach(variable => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="block text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">${variable}</label>
                    <input type="text" class="w-full p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300" 
                           placeholder="Valor para ${variable}" onchange="updatePreview()">
                `;
                variableInputs.appendChild(div);
            });
            
            let previewText = content;
            uniqueVars.forEach(variable => {
                const input = variableInputs.querySelector(`input[placeholder="Valor para ${variable}"]`);
                const value = input ? input.value || `{{${variable}}}` : `{{${variable}}}`;
                previewText = previewText.replace(new RegExp(`\\{\\{${variable}\\}\\}`, 'g'), value);
            });
            
            preview.textContent = previewText || 'Digite uma mensagem para ver a pr√©-visualiza√ß√£o...';
        }

        function saveMessage() {
            const title = document.getElementById('message-title').value.trim();
            const tags = document.getElementById('message-tags').value.trim();
            const content = document.getElementById('message-content').value.trim();
            
            if (!title || !content) {
                showNotification('Preencha t√≠tulo e conte√∫do', 'error');
                return;
            }
            
            const message = {
                id: Date.now(),
                title,
                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                content,
                createdAt: new Date().toISOString(),
                copyCount: 0
            };
            
            messages.push(message);
            localStorage.setItem('messages', JSON.stringify(messages));
            
            document.getElementById('message-title').value = '';
            document.getElementById('message-tags').value = '';
            document.getElementById('message-content').value = '';
            updatePreview();
            
            updateMessageStats();
            renderMessages();
            updateTagFilter();
            showNotification('Mensagem salva com sucesso!', 'success');
        }

        function updateMessageStats() {
            const total = messages.length;
            const copied = messages.reduce((sum, msg) => sum + msg.copyCount, 0);
            const withVariables = messages.filter(msg => msg.content.includes('{{')).length;
            const allTags = messages.flatMap(msg => msg.tags);
            const uniqueTags = new Set(allTags).size;
            
            document.getElementById('total-messages').textContent = total;
            document.getElementById('copied-messages').textContent = copied;
            document.getElementById('variable-messages').textContent = withVariables;
            document.getElementById('unique-tags').textContent = uniqueTags;
        }

        function renderMessages() {
            const container = document.getElementById('messages-list');
            const searchTerm = document.getElementById('search-messages').value.toLowerCase();
            const selectedTag = document.getElementById('filter-tag').value;
            
            let filteredMessages = messages.filter(msg => {
                const matchesSearch = msg.title.toLowerCase().includes(searchTerm) || 
                                    msg.content.toLowerCase().includes(searchTerm);
                const matchesTag = !selectedTag || msg.tags.includes(selectedTag);
                return matchesSearch && matchesTag;
            });
            
            container.innerHTML = filteredMessages.map(msg => `
                <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50 slide-up cursor-pointer transition-all duration-300 hover:scale-105" onclick="copyMessageCard(${msg.id}, this)">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white">${msg.title}</h3>
                        <div class="flex space-x-2">
                            <button onclick="event.stopPropagation(); copyMessage(${msg.id})" class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all duration-300 hover:scale-110">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button onclick="event.stopPropagation(); editMessage(${msg.id})" class="w-10 h-10 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-xl hover:bg-green-200 dark:hover:bg-green-900/50 transition-all duration-300 hover:scale-110">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="event.stopPropagation(); deleteMessage(${msg.id})" class="w-10 h-10 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-xl hover:bg-red-200 dark:hover:bg-red-900/50 transition-all duration-300 hover:scale-110">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-3 leading-relaxed">${msg.content}</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${msg.tags.map(tag => `<span class="px-3 py-1 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 text-blue-800 dark:text-blue-200 text-xs rounded-full font-medium">${tag}</span>`).join('')}
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400">
                        <div class="flex items-center">
                            <i class="fas fa-copy mr-1"></i>
                            <span>Copiada ${msg.copyCount} vezes</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-calendar mr-1"></i>
                            <span>${new Date(msg.createdAt).toLocaleDateString('pt-BR')}</span>
                        </div>
                    </div>
                </div>
            `).join('') || '<div class="col-span-full text-center py-12"><div class="w-24 h-24 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-inbox text-3xl text-gray-400"></i></div><p class="text-gray-500 dark:text-gray-400 text-lg font-medium">Nenhuma mensagem encontrada</p></div>';
        }

        function copyMessage(id) {
            const message = messages.find(msg => msg.id === id);
            if (!message) return;
            
            let content = message.content;
            
            const variables = content.match(/\{\{([^}]+)\}\}/g);
            if (variables) {
                const uniqueVars = [...new Set(variables.map(v => v.slice(2, -2)))];
                let replacedContent = content;
                
                uniqueVars.forEach(variable => {
                    const value = prompt(`Digite o valor para ${variable}:`);
                    if (value !== null) {
                        replacedContent = replacedContent.replace(new RegExp(`\\{\\{${variable}\\}\\}`, 'g'), value);
                    }
                });
                content = replacedContent;
            }
            
            navigator.clipboard.writeText(content).then(() => {
                message.copyCount++;
                localStorage.setItem('messages', JSON.stringify(messages));
                
                copyHistory.unshift({
                    id: Date.now(),
                    messageTitle: message.title,
                    content: content,
                    copiedAt: new Date().toISOString()
                });
                
                copyHistory = copyHistory.slice(0, 10);
                localStorage.setItem('copyHistory', JSON.stringify(copyHistory));
                
                updateMessageStats();
                renderMessages();
                renderCopyHistory();
                showNotification('Mensagem copiada com sucesso!', 'success');
            });
        }

        function copyMessageCard(id, cardElement) {
            const message = messages.find(msg => msg.id === id);
            if (!message) return;
            
            let content = message.content;
            
            const variables = content.match(/\{\{([^}]+)\}\}/g);
            if (variables) {
                const uniqueVars = [...new Set(variables.map(v => v.slice(2, -2)))];
                let replacedContent = content;
                
                uniqueVars.forEach(variable => {
                    const value = prompt(`Digite o valor para ${variable}:`);
                    if (value !== null) {
                        replacedContent = replacedContent.replace(new RegExp(`\\{\\{${variable}\\}\\}`, 'g'), value);
                    }
                });
                content = replacedContent;
            }
            
            navigator.clipboard.writeText(content).then(() => {
                // Salvar conte√∫do original
                const originalContent = cardElement.innerHTML;
                const originalClasses = cardElement.className;
                
                // Criar overlay de sucesso que mant√©m o tamanho do card
                const successOverlay = document.createElement('div');
                successOverlay.className = 'absolute inset-0 bg-gradient-to-br from-green-400 via-green-500 to-emerald-500 rounded-2xl flex items-center justify-center z-10 animate-pulse';
                successOverlay.innerHTML = `
                    <div class="text-center text-white transform animate-bounce">
                        <div class="relative">
                            <i class="fas fa-check-circle text-5xl mb-3 drop-shadow-lg"></i>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full animate-ping"></div>
                        </div>
                        <p class="font-bold text-xl tracking-wide drop-shadow-md">Copiado!</p>
                        <div class="mt-2 flex justify-center space-x-1">
                            <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                            <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                            <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                        </div>
                    </div>
                `;
                
                // Adicionar posi√ß√£o relativa ao card para o overlay funcionar
                cardElement.style.position = 'relative';
                cardElement.appendChild(successOverlay);
                
                // Adicionar efeito de brilho suave
                cardElement.style.boxShadow = '0 0 30px rgba(34, 197, 94, 0.5), 0 0 60px rgba(34, 197, 94, 0.3)';
                cardElement.style.transform = 'scale(1.02)';
                cardElement.style.transition = 'all 0.3s ease';
                
                // Voltar ao normal ap√≥s 1.8 segundos
                setTimeout(() => {
                    // Remover overlay com fade out
                    successOverlay.style.opacity = '0';
                    successOverlay.style.transform = 'scale(0.8)';
                    successOverlay.style.transition = 'all 0.3s ease';
                    
                    // Resetar estilos do card
                    cardElement.style.boxShadow = '';
                    cardElement.style.transform = '';
                    
                    setTimeout(() => {
                        if (successOverlay.parentNode) {
                            successOverlay.remove();
                        }
                        cardElement.style.position = '';
                    }, 300);
                    
                    message.copyCount++;
                    localStorage.setItem('messages', JSON.stringify(messages));
                    
                    copyHistory.unshift({
                        id: Date.now(),
                        messageTitle: message.title,
                        content: content,
                        copiedAt: new Date().toISOString()
                    });
                    
                    copyHistory = copyHistory.slice(0, 10);
                    localStorage.setItem('copyHistory', JSON.stringify(copyHistory));
                    
                    updateMessageStats();
                    renderMessages();
                    renderCopyHistory();
                }, 1800);
            });
        }

        function editMessage(id) {
            const message = messages.find(msg => msg.id === id);
            if (!message) return;
            
            // Preencher o formul√°rio com os dados da mensagem
            document.getElementById('message-title').value = message.title;
            document.getElementById('message-tags').value = message.tags.join(', ');
            document.getElementById('message-content').value = message.content;
            
            // Atualizar preview
            updatePreview();
            
            // Remover a mensagem original (ser√° recriada ao salvar)
            messages = messages.filter(msg => msg.id !== id);
            localStorage.setItem('messages', JSON.stringify(messages));
            
            // Scroll para o formul√°rio
            document.getElementById('message-title').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('message-title').focus();
            
            updateMessageStats();
            renderMessages();
            updateTagFilter();
            showNotification('Mensagem carregada para edi√ß√£o!', 'info');
        }

        function deleteMessage(id) {
            if (confirm('Tem certeza que deseja excluir esta mensagem?')) {
                messages = messages.filter(msg => msg.id !== id);
                localStorage.setItem('messages', JSON.stringify(messages));
                updateMessageStats();
                renderMessages();
                updateTagFilter();
                showNotification('Mensagem exclu√≠da!', 'success');
            }
        }

        function filterMessages() {
            renderMessages();
        }

        function updateTagFilter() {
            const select = document.getElementById('filter-tag');
            const allTags = [...new Set(messages.flatMap(msg => msg.tags))];
            
            select.innerHTML = '<option value="">Todas as tags</option>' +
                allTags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
        }

        function renderCopyHistory() {
            const container = document.getElementById('copy-history');
            container.innerHTML = copyHistory.map(item => `
                <div class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border border-green-200/50 dark:border-green-700/50 hover-lift">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 dark:text-white mb-1">${item.messageTitle}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</p>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 ml-4 text-right">
                        <i class="fas fa-clock mr-1"></i>
                        ${new Date(item.copiedAt).toLocaleString('pt-BR')}
                    </div>
                </div>
            `).join('') || '<div class="text-center py-8"><div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-history text-2xl text-gray-400"></i></div><p class="text-gray-500 dark:text-gray-400 font-medium">Nenhuma mensagem copiada ainda</p></div>';
        }

        // Services Module Functions
        function addCustomStatus() {
            const container = document.getElementById('custom-status-list');
            const statusDiv = document.createElement('div');
            statusDiv.className = 'flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 slide-up';
            statusDiv.innerHTML = `
                <input type="text" placeholder="Nome do status" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm">
                <input type="color" value="#8B5CF6" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                <button type="button" onclick="this.parentElement.remove()" class="w-8 h-8 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-all duration-300">
                    <i class="fas fa-trash text-xs"></i>
                </button>
            `;
            container.appendChild(statusDiv);
        }

        function saveService() {
            const name = document.getElementById('service-name').value.trim();
            const description = document.getElementById('service-description').value.trim();
            const color = document.getElementById('service-color').value;
            
            if (!name) {
                showNotification('Digite o nome do servi√ßo', 'error');
                return;
            }
            
            // Coletar status personalizados
            const statusElements = document.querySelectorAll('#custom-status-list > div');
            const customStatuses = [];
            const items = [];
            
            statusElements.forEach((statusDiv, index) => {
                const nameInput = statusDiv.querySelector('input[type="text"]');
                const colorInput = statusDiv.querySelector('input[type="color"]');
                const quantityInput = statusDiv.querySelector('input[type="number"]');
                
                const statusName = nameInput.value.trim();
                const statusColor = colorInput.value;
                const quantity = parseInt(quantityInput.value) || 0;
                
                if (statusName) {
                    const statusKey = statusName.toLowerCase().replace(/\s+/g, '_');
                    customStatuses.push({
                        key: statusKey,
                        name: statusName,
                        color: statusColor
                    });
                    
                    // Criar itens automaticamente para este status
                    for (let i = 1; i <= quantity; i++) {
                        items.push({
                            id: Date.now() + Math.random(),
                            name: `${statusName} - Item ${i}`,
                            description: `Item ${i} do status ${statusName}`,
                            status: statusKey,
                            createdAt: new Date().toISOString()
                        });
                    }
                }
            });
            
            if (customStatuses.length === 0) {
                showNotification('Adicione pelo menos um status', 'error');
                return;
            }
            
            const service = {
                id: Date.now(),
                name,
                description,
                color,
                status: customStatuses[0].key, // Primeiro status como padr√£o
                customStatuses,
                createdAt: new Date().toISOString(),
                items
            };
            
            services.push(service);
            localStorage.setItem('services', JSON.stringify(services));
            
            // Limpar formul√°rio
            document.getElementById('service-name').value = '';
            document.getElementById('service-description').value = '';
            
            // Resetar status para os padr√µes
            const statusList = document.getElementById('custom-status-list');
            statusList.innerHTML = `
                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                    <input type="text" value="Pendente" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                    <input type="color" value="#F59E0B" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                </div>
                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                    <input type="text" value="Em Andamento" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                    <input type="color" value="#3B82F6" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                </div>
                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                    <input type="text" value="Conclu√≠do" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm" readonly>
                    <input type="color" value="#10B981" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                    <input type="number" value="0" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                    <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                </div>
            `;
            
            updateServiceStats();
            renderServices();
            showNotification(`Servi√ßo criado com ${items.length} itens distribu√≠dos pelos status!`, 'success');
        }

        function updateServiceStats() {
            const total = services.length;
            const pending = services.filter(s => s.status === 'pendente').length;
            const progress = services.filter(s => s.status === 'andamento').length;
            const completed = services.filter(s => s.status === 'concluido').length;
            
            document.getElementById('total-services').textContent = total;
            document.getElementById('pending-services').textContent = pending;
            document.getElementById('progress-services').textContent = progress;
            document.getElementById('completed-services').textContent = completed;
        }

        function renderServices() {
            const container = document.getElementById('services-list');
            container.innerHTML = services.map(service => {
                // Corrigir customStatuses caso esteja undefined
                const customStatuses = Array.isArray(service.customStatuses) && service.customStatuses.length > 0
                    ? service.customStatuses
                    : [
                        { key: 'pendente', name: 'Pendente', color: '#F59E0B' },
                        { key: 'andamento', name: 'Em Andamento', color: '#3B82F6' },
                        { key: 'concluido', name: 'Conclu√≠do', color: '#10B981' }
                    ];
                service.customStatuses = customStatuses; // Garante que sempre existe

                const completedStatusKeys = customStatuses.filter(s => 
                    s.name.toLowerCase().includes('conclu√≠do') || 
                    s.name.toLowerCase().includes('finalizado') ||
                    s.name.toLowerCase().includes('completo')
                ).map(s => s.key);

                const totalItems = Array.isArray(service.items) ? service.items.length : 0;
                const realCompletedItems = Array.isArray(service.items)
                    ? service.items.filter(item => completedStatusKeys.includes(item.status)).length
                    : 0;
                const realProgress = totalItems > 0 ? (realCompletedItems / totalItems) * 100 : 0;

                return `
                    <div class="bg-white/80 dark:bg-gray-800/80 glass-effect p-6 rounded-2xl shadow-lg hover-lift border border-gray-200/50 dark:border-gray-700/50 slide-up min-h-[280px] flex flex-col cursor-pointer" onclick="openServiceModal(${service.id})">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3 mb-4">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors flex-1 min-w-0" onclick="openServiceModal(${service.id})" title="${service.name}">
                                ${service.name.length > 30 ? service.name.substring(0, 30) + '...' : service.name}
                            </h3>
                            <div class="flex items-center gap-2 flex-shrink-0">
                                <select onchange="updateServiceStatus(${service.id}, this.value, this)" class="px-3 py-1 text-xs font-medium rounded-full text-white whitespace-nowrap border-0 cursor-pointer focus:ring-2 focus:ring-white/50 transition-all duration-300" style="background: ${getStatusColor(service.status, service)};">
                                    ${(customStatuses).map(status =>
                                        `<option value="${status.key}" ${service.status === status.key ? 'selected' : ''} style="background-color: ${status.color}; color: white;">${status.name}</option>`
                                    ).join('')}
                                </select>
                                <div class="flex gap-1">
                                    <button onclick="event.stopPropagation(); editService(${service.id})" class="w-7 h-7 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition-all duration-300 hover:scale-110 flex items-center justify-center" title="Editar">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button onclick="event.stopPropagation(); deleteService(${service.id})" class="w-7 h-7 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-all duration-300 hover:scale-110 flex items-center justify-center" title="Excluir">
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 flex flex-col">
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-6 leading-relaxed line-clamp-3 flex-1">
                                ${service.description || 'Sem descri√ß√£o'}
                            </p>
                            <div class="mt-auto">
                                <div class="mb-4">
                                    <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
                                        <span class="font-medium">Progresso</span>
                                        <span class="font-semibold">${realCompletedItems}/${totalItems} itens</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden">
                                        <div class="h-2.5 rounded-full transition-all duration-500 ease-out" style="width: ${realProgress}%; background: linear-gradient(90deg, ${service.color}, ${service.color}88)"></div>
                                    </div>
                                    <div class="text-right mt-1">
                                        <span class="text-xs font-semibold text-gray-700 dark:text-gray-300">${Math.round(realProgress)}%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400 pt-3 border-t border-gray-200/50 dark:border-gray-600/50">
                                    <div class="flex items-center">
                                        <div class="w-2.5 h-2.5 rounded-full mr-2 flex-shrink-0" style="background-color: ${service.color}"></div>
                                        <span class="truncate">${customStatuses.length} status</span>
                                    </div>
                                    <div class="flex items-center flex-shrink-0">
                                        <i class="fas fa-calendar mr-1"></i>
                                        <span>${new Date(service.createdAt).toLocaleDateString('pt-BR')}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('') || '<div class="col-span-full text-center py-12"><div class="w-24 h-24 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-briefcase text-3xl text-gray-400"></i></div><p class="text-gray-500 dark:text-gray-400 text-lg font-medium">Nenhum servi√ßo criado ainda</p></div>';
        }

        function getStatusClass(status, service = null) {
            // Se temos um servi√ßo com status personalizados, usar suas cores
            if (service && service.customStatuses) {
                const customStatus = service.customStatuses.find(s => s.key === status);
                if (customStatus) {
                    const color = customStatus.color;
                    const r = parseInt(color.slice(1, 3), 16);
                    const g = parseInt(color.slice(3, 5), 16);
                    const b = parseInt(color.slice(5, 7), 16);
                    return `bg-gradient-to-r text-white shadow-lg border border-white/20`;
                }
            }
            
            // Classes padr√£o
            const classes = {
                'pendente': 'bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-800 dark:from-yellow-900/30 dark:to-orange-900/30 dark:text-yellow-200',
                'andamento': 'bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-800 dark:from-blue-900/30 dark:to-indigo-900/30 dark:text-blue-200',
                'em_andamento': 'bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-800 dark:from-blue-900/30 dark:to-indigo-900/30 dark:text-blue-200',
                'concluido': 'bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 dark:from-green-900/30 dark:to-emerald-900/30 dark:text-green-200',
                'cancelado': 'bg-gradient-to-r from-red-100 to-pink-100 text-red-800 dark:from-red-900/30 dark:to-pink-900/30 dark:text-red-200'
            };
            return classes[status] || classes['pendente'];
        }

        function getStatusText(status, service = null) {
            // Se temos um servi√ßo com status personalizados, usar seus nomes
            if (service && service.customStatuses) {
                const customStatus = service.customStatuses.find(s => s.key === status);
                if (customStatus) {
                    return customStatus.name;
                }
            }
            
            // Textos padr√£o
            const texts = {
                'pendente': 'Pendente',
                'andamento': 'Em Andamento',
                'em_andamento': 'Em Andamento',
                'concluido': 'Conclu√≠do',
                'cancelado': 'Cancelado'
            };
            return texts[status] || 'Pendente';
        }

        function getStatusColor(status, service = null) {
            // Se temos um servi√ßo com status personalizados, usar suas cores
            if (service && service.customStatuses) {
                const customStatus = service.customStatuses.find(s => s.key === status);
                if (customStatus) {
                    return customStatus.color;
                }
            }
            
            // Cores padr√£o
            const colors = {
                'pendente': '#F59E0B',
                'andamento': '#3B82F6',
                'em_andamento': '#3B82F6',
                'concluido': '#10B981',
                'cancelado': '#EF4444'
            };
            return colors[status] || '#F59E0B';
        }

        function openServiceModal(serviceId) {
            console.log('Abrindo modal para servi√ßo:', serviceId); // Debug
            currentService = services.find(s => s.id == serviceId); // Usar == para compara√ß√£o flex√≠vel
            if (!currentService) {
                console.log('Servi√ßo n√£o encontrado:', serviceId, services); // Debug
                return;
            }
            
            console.log('Servi√ßo encontrado:', currentService); // Debug
            
            // Resetar pagina√ß√£o
            currentPage = 1;
            
            // Preencher informa√ß√µes b√°sicas
            const modalServiceName = document.getElementById('modal-service-name');
            const modalServiceDescription = document.getElementById('modal-service-description');
            const modalServiceStatus = document.getElementById('modal-service-status');
            const modalServiceItems = document.getElementById('modal-service-items');
            
            if (modalServiceName) modalServiceName.textContent = currentService.name;
            if (modalServiceDescription) modalServiceDescription.textContent = currentService.description || 'Sem descri√ß√£o';
            if (modalServiceStatus) modalServiceStatus.textContent = getStatusText(currentService.status, currentService);
            if (modalServiceItems) modalServiceItems.textContent = currentService.items ? currentService.items.length : 0;
            
            // Garantir que customStatuses existe
            if (!currentService.customStatuses) {
                currentService.customStatuses = [
                    { key: 'pendente', name: 'Pendente', color: '#F59E0B' },
                    { key: 'andamento', name: 'Em Andamento', color: '#3B82F6' },
                    { key: 'concluido', name: 'Conclu√≠do', color: '#10B981' }
                ];
            }
            
            // Preencher select de status com os status personalizados
            const filterStatusSelect = document.getElementById('filter-item-status');
            
            if (filterStatusSelect) {
                filterStatusSelect.innerHTML = '<option value="">Todos os status</option>' +
                    currentService.customStatuses.map(status => 
                        `<option value="${status.key}">${status.name}</option>`
                    ).join('');
            }
            
            // Garantir que os itens existam
            if (!currentService.items) {
                currentService.items = [];
            }
            
            // Renderizar gr√°fico e itens
            setTimeout(() => {
                renderServiceChart();
                renderServiceItems();
            }, 100);
            
            // Mostrar modal
            const serviceModal = document.getElementById('service-modal');
            if (serviceModal) {
                serviceModal.classList.remove('hidden');
                console.log('Modal aberto com sucesso'); // Debug
            }
        }

        function closeServiceModal() {
            document.getElementById('service-modal').classList.add('hidden');
            currentService = null;
            if (serviceChart) {
                serviceChart.destroy();
                serviceChart = null;
            }
        }

        function renderServiceChart() {
            const ctx = document.getElementById('service-chart').getContext('2d');
            
            if (serviceChart) {
                serviceChart.destroy();
            }
            
            // Garantir que customStatuses existe e tem dados v√°lidos
            if (!currentService.customStatuses || !Array.isArray(currentService.customStatuses) || currentService.customStatuses.length === 0) {
                currentService.customStatuses = [
                    { key: 'pendente', name: 'Pendente', color: '#F59E0B' },
                    { key: 'andamento', name: 'Em Andamento', color: '#3B82F6' },
                    { key: 'concluido', name: 'Conclu√≠do', color: '#10B981' }
                ];
                // Salvar a corre√ß√£o no localStorage
                localStorage.setItem('services', JSON.stringify(services));
            }
            
            // Usar status personalizados
            const customStatuses = currentService.customStatuses;
            
            const statusCounts = {};
            const labels = [];
            const colors = [];
            const borderColors = [];
            
            // Inicializar contadores
            customStatuses.forEach(status => {
                statusCounts[status.key] = 0;
                labels.push(status.name);
                colors.push(status.color + '80'); // Adicionar transpar√™ncia
                borderColors.push(status.color);
            });
            
            // Contar itens por status
            currentService.items.forEach(item => {
                if (statusCounts.hasOwnProperty(item.status)) {
                    statusCounts[item.status]++;
                }
            });
            
            const data = customStatuses.map(status => statusCounts[status.key]);
            
            serviceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: currentTheme === 'dark' ? '#E5E7EB' : '#374151',
                                padding: 20,
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });
        }

        function addServiceItem() {
            const name = document.getElementById('item-name').value.trim();
            const description = document.getElementById('item-description').value.trim();
            const status = document.getElementById('item-status').value;
            
            if (!name) {
                showNotification('Digite o nome do item', 'error');
                return;
            }
            
            const item = {
                id: Date.now(),
                name,
                description,
                status,
                createdAt: new Date().toISOString()
            };
            
            currentService.items.push(item);
            localStorage.setItem('services', JSON.stringify(services));
            
            document.getElementById('item-name').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-status').value = 'pendente';
            
            document.getElementById('modal-service-items').textContent = currentService.items.length;
            renderServiceChart();
            renderServiceItems();
            renderServices();
            showNotification('Item adicionado com sucesso!', 'success');
        }

        function renderServiceItems() {
            console.log('Renderizando itens do servi√ßo:', currentService); // Debug
            
            if (!currentService || !currentService.items) {
                console.log('Servi√ßo ou itens n√£o encontrados'); // Debug
                return;
            }
            
            const tbody = document.getElementById('service-items-table');
            const searchInput = document.getElementById('filter-items');
            const statusFilterSelect = document.getElementById('filter-item-status');
            
            if (!tbody || !searchInput || !statusFilterSelect) {
                console.log('Elementos do DOM n√£o encontrados'); // Debug
                return;
            }
            
            const searchTerm = searchInput.value.toLowerCase();
            const statusFilter = statusFilterSelect.value;
            
            let filteredItems = currentService.items.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    (item.description && item.description.toLowerCase().includes(searchTerm));
                const matchesStatus = !statusFilter || item.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            console.log('Itens filtrados:', filteredItems.length); // Debug
            console.log('Status personalizados dispon√≠veis:', currentService.customStatuses); // Debug
            
            // Calcular pagina√ß√£o
            const totalItems = filteredItems.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = filteredItems.slice(startIndex, endIndex);
            
            console.log('Itens da p√°gina atual:', paginatedItems.length); // Debug
            
            // Debug dos primeiros itens para verificar status
            paginatedItems.slice(0, 3).forEach((item, index) => {
                console.log(`Item ${index + 1}:`, {
                    name: item.name,
                    status: item.status,
                    statusName: currentService.customStatuses?.find(s => s.key === item.status)?.name || 'Status n√£o encontrado'
                });
            });
            
            // Renderizar itens da p√°gina atual
            if (paginatedItems.length > 0) {
                tbody.innerHTML = paginatedItems.map(item => {
                    // Verificar se o status do item existe nos status personalizados
                    const currentItemStatus = currentService.customStatuses?.find(s => s.key === item.status);
                    const statusColor = currentItemStatus ? currentItemStatus.color : '#6B7280';
                    
                    console.log(`Renderizando item "${item.name}" com status "${item.status}" (${currentItemStatus?.name || 'N√£o encontrado'})`);
                    
                    return `
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200">
                            <td class="p-4 text-gray-800 dark:text-white font-medium">${item.name}</td>
                            <td class="p-4 text-gray-600 dark:text-gray-400">${item.description || '-'}</td>
                            <td class="p-4">
                                <select onchange="updateItemStatus(${item.id}, this.value)" class="px-3 py-2 border-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 font-medium text-white" style="background-color: ${statusColor}; border-color: ${statusColor};">
                                    ${(currentService.customStatuses || []).map(status => 
                                        `<option value="${status.key}" ${item.status === status.key ? 'selected' : ''} style="background-color: ${status.color}; color: white;">${status.name}</option>`
                                    ).join('')}
                                </select>
                            </td>
                            <td class="p-4 text-gray-600 dark:text-gray-400">${new Date(item.createdAt).toLocaleDateString('pt-BR')}</td>
                            <td class="p-4">
                                <div class="flex space-x-2">
                                    <button onclick="editServiceItem(${item.id})" class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all duration-300">
                                        <i class="fas fa-edit text-sm"></i>
                                    </button>
                                    <button onclick="deleteServiceItem(${item.id})" class="w-8 h-8 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-all duration-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            } else {
                tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500 dark:text-gray-400">Nenhum item encontrado</td></tr>';
            }
            
            // Atualizar controles de pagina√ß√£o
            updatePagination(totalItems, totalPages);
        }

        function filterServiceItems() {
            currentPage = 1; // Resetar para primeira p√°gina ao filtrar
            renderServiceItems();
        }

        function updatePagination(totalItems, totalPages) {
            const paginationInfo = document.getElementById('pagination-info');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');
            const pageNumbers = document.getElementById('page-numbers');
            const paginationContainer = document.getElementById('pagination-container');
            
            // Mostrar/ocultar pagina√ß√£o baseado no n√∫mero de itens
            if (totalItems <= itemsPerPage) {
                paginationContainer.style.display = 'none';
                return;
            } else {
                paginationContainer.style.display = 'block';
            }
            
            // Atualizar informa√ß√µes
            const startItem = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);
            paginationInfo.textContent = `Mostrando ${startItem} a ${endItem} de ${totalItems} itens`;
            
            // Atualizar bot√µes anterior/pr√≥ximo
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === totalPages || totalPages === 0;
            
            // Gerar n√∫meros das p√°ginas
            pageNumbers.innerHTML = '';
            
            if (totalPages <= 7) {
                // Mostrar todas as p√°ginas se forem poucas
                for (let i = 1; i <= totalPages; i++) {
                    pageNumbers.appendChild(createPageButton(i));
                }
            } else {
                // L√≥gica para muitas p√°ginas
                pageNumbers.appendChild(createPageButton(1));
                
                if (currentPage > 4) {
                    pageNumbers.appendChild(createEllipsis());
                }
                
                const start = Math.max(2, currentPage - 2);
                const end = Math.min(totalPages - 1, currentPage + 2);
                
                for (let i = start; i <= end; i++) {
                    pageNumbers.appendChild(createPageButton(i));
                }
                
                if (currentPage < totalPages - 3) {
                    pageNumbers.appendChild(createEllipsis());
                }
                
                if (totalPages > 1) {
                    pageNumbers.appendChild(createPageButton(totalPages));
                }
            }
        }

        function createPageButton(pageNum) {
            const button = document.createElement('button');
            button.className = `w-10 h-10 rounded-lg font-medium transition-all duration-300 ${
                pageNum === currentPage 
                    ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg' 
                    : 'bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'
            }`;
            button.textContent = pageNum;
            button.onclick = () => changePage(pageNum);
            return button;
        }

        function createEllipsis() {
            const span = document.createElement('span');
            span.className = 'w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400';
            span.textContent = '...';
            return span;
        }

        function changePage(newPage) {
            const searchTerm = document.getElementById('filter-items').value.toLowerCase();
            const statusFilter = document.getElementById('filter-item-status').value;
            
            let filteredItems = currentService.items.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.description.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || item.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderServiceItems();
            }
        }

        function updateItemStatus(itemId, newStatus) {
            const item = currentService.items.find(i => i.id === itemId);
            if (!item) return;
            
            item.status = newStatus;
            localStorage.setItem('services', JSON.stringify(services));
            
            // Atualizar o gr√°fico e estat√≠sticas
            renderServiceChart();
            renderServices();
            
            // Mostrar notifica√ß√£o
            const statusName = getStatusText(newStatus, currentService);
            showNotification(`Status alterado para "${statusName}"!`, 'success');
        }

        function editServiceItem(itemId) {
            const item = currentService.items.find(i => i.id === itemId);
            if (!item) return;
            
            const newName = prompt('Novo nome do item:', item.name);
            if (newName && newName.trim()) {
                item.name = newName.trim();
                localStorage.setItem('services', JSON.stringify(services));
                renderServiceItems();
                renderServices();
                showNotification('Item atualizado com sucesso!', 'success');
            }
        }

        function deleteServiceItem(itemId) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                currentService.items = currentService.items.filter(i => i.id !== itemId);
                localStorage.setItem('services', JSON.stringify(services));
                document.getElementById('modal-service-items').textContent = currentService.items.length;
                renderServiceChart();
                renderServiceItems();
                renderServices();
                showNotification('Item exclu√≠do com sucesso!', 'success');
            }
        }

        function importExcel() {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Selecione um arquivo', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        showNotification('Planilha vazia ou formato inv√°lido', 'error');
                        return;
                    }
                    
                    console.log('Dados da planilha:', jsonData); // Debug
                    
                    // SEMPRE criar um √∫nico servi√ßo com todos os dados
                    createSingleServiceFromSpreadsheet(jsonData, file.name);
                    
                    fileInput.value = '';
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    showNotification('Erro ao importar arquivo. Verifique o formato.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function createSingleServiceFromSpreadsheet(jsonData, fileName) {
            // Detectar colunas
            const firstRow = jsonData[0];
            const columns = Object.keys(firstRow);

            // Detectar coluna de nome
            const nameColumns = columns.filter(col => col.toLowerCase().includes('nome') || col.toLowerCase().includes('name'));
            const nameColumn = nameColumns[0] || columns[0];

            // Detectar coluna de status
            const statusColumns = columns.filter(col => col.toLowerCase().includes('status'));
            const statusColumn = statusColumns[0];

            // Extrair todos os status √∫nicos exatamente como aparecem na planilha
            const allUniqueStatuses = Array.from(new Set(jsonData.map(row => {
                let status = row[statusColumn];
                if (status && typeof status === 'string') {
                    status = status.split(':')[0].trim();
                }
                return status ? status.trim() : 'Pendente';
            })));

            // Gerar cores para status
            const statusColors = ['#1E3A8A', '#3B82F6', '#059669', '#DC2626', '#7C3AED', '#EA580C', '#0891B2', '#65A30D'];
            const customStatuses = allUniqueStatuses.map((statusName, idx) => ({
                key: statusName.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, ''),
                name: statusName,
                color: statusColors[idx % statusColors.length]
            }));

            customStatuses.forEach(status => {
                if (status.name.trim().toLowerCase() === 'pendente') {
                    status.color = '#F59E0B'; // Laranja
                }
            });

            // Criar itens usando o status exato da planilha
            const items = jsonData.map((row, idx) => {
                let statusValue = row[statusColumn];
                if (statusValue && typeof statusValue === 'string') {
                    statusValue = statusValue.split(':')[0].trim();
                }
                // Corre√ß√£o: comparar ignorando mai√∫sculas/min√∫sculas e espa√ßos
                const statusObj = customStatuses.find(s => s.name.trim().toLowerCase() === (statusValue ? statusValue.trim().toLowerCase() : 'pendente')) || customStatuses[0];
                return {
                    id: Date.now() + Math.random() + idx,
                    name: row[nameColumn] ? row[nameColumn].toString().trim() : `Item ${idx + 1}`,
                    description: '',
                    status: statusObj.key,
                    createdAt: new Date().toISOString()
                };
            });

            // Criar servi√ßo √∫nico
            const cleanFileName = fileName.replace(/\.[^/.]+$/, "").replace(/[^a-zA-Z0-9\s]/g, '') || 'Planilha Importada';
            const service = {
                id: Date.now(),
                name: `${cleanFileName}`,
                description: `Projeto criado a partir da importa√ß√£o de planilha Excel/CSV com ${jsonData.length} itens.`,
                color: '#1E3A8A',
                status: customStatuses[0]?.key || 'pendente',
                customStatuses: customStatuses,
                createdAt: new Date().toISOString(),
                items: items
            };

            services.push(service);
            localStorage.setItem('services', JSON.stringify(services));
            updateServiceStats();
            renderServices();
            showNotification(`‚úÖ Projeto "${cleanFileName}" criado com ${jsonData.length} itens e ${customStatuses.length} status!`, 'success');
        }

        function editService(id) {
            const service = services.find(s => s.id === id);
            if (!service) return;
            
            // Preencher o formul√°rio com os dados do servi√ßo
            document.getElementById('service-name').value = service.name;
            document.getElementById('service-description').value = service.description;
            document.getElementById('service-color').value = service.color;
            
            // Preencher status personalizados se existirem
            if (service.customStatuses && service.customStatuses.length > 0) {
                const statusList = document.getElementById('custom-status-list');
                statusList.innerHTML = '';
                
                service.customStatuses.forEach(status => {
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600';
                    
                    // Contar quantos itens existem para este status
                    const itemCount = service.items.filter(item => item.status === status.key).length;
                    
                    statusDiv.innerHTML = `
                        <input type="text" value="${status.name}" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm">
                        <input type="color" value="${status.color}" class="w-10 h-8 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                        <input type="number" value="${itemCount}" min="0" class="w-20 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-sm text-center" placeholder="Qtd">
                        <span class="text-xs text-gray-500 dark:text-gray-400 w-8">itens</span>
                        <button type="button" onclick="this.parentElement.remove()" class="w-8 h-8 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-all duration-300">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    `;
                    statusList.appendChild(statusDiv);
                });
            }
            
            // Remover o servi√ßo original (ser√° recriado ao salvar)
            services = services.filter(s => s.id !== id);
            localStorage.setItem('services', JSON.stringify(services));
            
            // Scroll para o formul√°rio
            document.getElementById('service-name').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('service-name').focus();
            
            updateServiceStats();
            renderServices();
            showNotification('Servi√ßo carregado para edi√ß√£o!', 'info');
        }

        function updateServiceStatus(serviceId, newStatus, selectElement) {
            const service = services.find(s => s.id === serviceId);
            if (!service) return;
            
            service.status = newStatus;
            localStorage.setItem('services', JSON.stringify(services));
            
            // Atualizar a cor de fundo do select
            const statusColor = getStatusColor(newStatus, service);
            selectElement.style.background = statusColor;
            
            // Atualizar estat√≠sticas e re-renderizar
            updateServiceStats();
            
            // Mostrar notifica√ß√£o
            const statusName = getStatusText(newStatus, service);
            showNotification(`Status do servi√ßo alterado para "${statusName}"!`, 'success');
        }

        function deleteService(id) {
            if (confirm('Tem certeza que deseja excluir este servi√ßo? Todos os itens associados tamb√©m ser√£o removidos.')) {
                services = services.filter(s => s.id !== id);
                localStorage.setItem('services', JSON.stringify(services));
                updateServiceStats();
                renderServices();
                showNotification('Servi√ßo exclu√≠do com sucesso!', 'success');
            }
        }

        function exportServicePDF() {
            if (!currentService) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('portrait', 'mm', 'a4');
            
            // Calcular estat√≠sticas
            const customStatuses = currentService.customStatuses || [
                { key: 'pendente', name: 'Pendente', color: '#F59E0B' },
                { key: 'andamento', name: 'Em Andamento', color: '#3B82F6' },
                { key: 'concluido', name: 'Conclu√≠do', color: '#10B981' }
            ];
            
            const statusCounts = {};
            customStatuses.forEach(status => {
                statusCounts[status.key] = currentService.items.filter(item => item.status === status.key).length;
            });
            
            const totalItems = currentService.items.length;
            const completedStatusKeys = customStatuses.filter(s => 
                s.name.toLowerCase().includes('conclu√≠do') || 
                s.name.toLowerCase().includes('finalizado') ||
                s.name.toLowerCase().includes('completo')
            ).map(s => s.key);
            
            const completedItems = currentService.items.filter(item => 
                completedStatusKeys.includes(item.status)
            ).length;
            
            const progress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
            
            // ===== HEADER LIMPO =====
            doc.setFillColor(30, 58, 138);
            doc.rect(0, 0, 210, 35, 'F');
            
            // T√≠tulo
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text(currentService.name, 20, 20);
            
            // Subt√≠tulo removido
            
            // Data
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 140, 28);
            
            // ===== CARDS DE ESTAT√çSTICAS =====
            const cardY = 50;
            const cardWidth = 40;
            const cardHeight = 25;
            const cardSpacing = 5;
            
            const cards = [
                { title: 'Total', value: totalItems.toString(), color: [30, 58, 138] },
                { title: 'Conclu√≠do', value: completedItems.toString(), color: [59, 130, 246] },
                { title: 'Progresso', value: `${progress}%`, color: [55, 65, 81] },
                { title: 'Status', value: customStatuses.length.toString(), color: [30, 58, 138] }
            ];
            
            cards.forEach((card, index) => {
                const x = 20 + (index * (cardWidth + cardSpacing));
                
                // Fundo do card
                doc.setFillColor(card.color[0], card.color[1], card.color[2]);
                doc.roundedRect(x, cardY, cardWidth, cardHeight, 3, 3, 'F');
                
                // T√≠tulo
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(card.title, x + 3, cardY + 8);
                
                // Valor
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text(card.value, x + 3, cardY + 20);
            });
            
            // ===== GR√ÅFICO DE BARRAS SIMPLES =====
            doc.setTextColor(45, 55, 72);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Distribui√ß√£o por Status', 20, 95);
            
            const chartX = 20;
            const chartY = 105;
            const chartWidth = 170;
            const chartHeight = 60;
            const maxValue = Math.max(...Object.values(statusCounts), 1);
            
            // Cores corporativas azuis
            const professionalColors = [
                [30, 58, 138],    // Azul marinho principal
                [59, 130, 246],   // Azul m√©dio
                [55, 65, 81],     // Cinza escuro
                [107, 114, 128],  // Cinza m√©dio
                [156, 163, 175],  // Cinza claro
                [30, 58, 138],    // Azul marinho (repetir)
                [59, 130, 246],   // Azul m√©dio (repetir)
                [75, 85, 99]      // Cinza escuro varia√ß√£o
            ];
            
            // Fundo do gr√°fico
            doc.setFillColor(248, 250, 252);
            doc.rect(chartX, chartY, chartWidth, chartHeight, 'F');
            
            // Calcular espa√ßamento para centralizar
            const totalBarsWidth = customStatuses.length * 25 + (customStatuses.length - 1) * 8; // 25 largura + 8 espa√ßo
            const startX = chartX + (chartWidth - totalBarsWidth) / 2;
            
            // Barras
            const barWidth = 25;
            const barSpacing = 8;
            customStatuses.forEach((status, index) => {
                const count = statusCounts[status.key];
                const barHeight = (count / maxValue) * (chartHeight - 20);
                const x = startX + (index * (barWidth + barSpacing));
                const y = chartY + chartHeight - 10 - barHeight;
                
                // Usar cores profissionais
                const colorIndex = index % professionalColors.length;
                const [r, g, b] = professionalColors[colorIndex];
                
                doc.setFillColor(r, g, b);
                doc.rect(x, y, barWidth, barHeight, 'F');
                
                // Valor no topo da barra
                doc.setTextColor(45, 55, 72);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text(count.toString(), x + barWidth/2 - 3, y - 3);
                
                // Label do status
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                const labelText = status.name.length > 8 ? status.name.substring(0, 8) + '...' : status.name;
                doc.text(labelText, x + 2, chartY + chartHeight + 5);
            });
            
            // ===== TABELA DE STATUS =====
            doc.setTextColor(45, 55, 72);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Detalhamento por Status', 20, 185);
            
            const tableY = 195;
            const rowHeight = 12;
            
            // Cabe√ßalho da tabela
            doc.setFillColor(30, 58, 138);
            doc.rect(20, tableY, 170, rowHeight, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Status', 25, tableY + 8);
            doc.text('Quantidade', 80, tableY + 8);
            doc.text('Percentual', 130, tableY + 8);
            
            // Linhas da tabela
            customStatuses.forEach((status, index) => {
                const count = statusCounts[status.key];
                const percentage = totalItems > 0 ? ((count / totalItems) * 100).toFixed(1) : '0.0';
                const y = tableY + rowHeight + (index * rowHeight);
                
                // Fundo alternado
                if (index % 2 === 0) {
                    doc.setFillColor(248, 250, 252);
                    doc.rect(20, y, 170, rowHeight, 'F');
                }
                
                // Usar cores profissionais
                const colorIndex = index % professionalColors.length;
                const [r, g, b] = professionalColors[colorIndex];
                
                // Indicador de cor
                doc.setFillColor(r, g, b);
                doc.circle(27, y + 6, 3, 'F');
                
                // Texto
                doc.setTextColor(45, 55, 72);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(status.name, 35, y + 8);
                doc.text(count.toString(), 85, y + 8);
                doc.text(`${percentage}%`, 135, y + 8);
            });
            
            // ===== BARRA DE PROGRESSO GERAL =====
            const progressY = tableY + rowHeight + (customStatuses.length * rowHeight) + 20;
            
            doc.setTextColor(45, 55, 72);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(`Progresso Geral: ${progress}%`, 20, progressY);
            
            // Barra de progresso
            const progressBarY = progressY + 8;
            const progressBarWidth = 170;
            const progressBarHeight = 8;
            
            // Fundo da barra
            doc.setFillColor(226, 232, 240);
            doc.roundedRect(20, progressBarY, progressBarWidth, progressBarHeight, 4, 4, 'F');
            
            // Barra de progresso
            const filledWidth = (progress / 100) * progressBarWidth;
            if (filledWidth > 0) {
                doc.setFillColor(30, 58, 138);
                doc.roundedRect(20, progressBarY, filledWidth, progressBarHeight, 4, 4, 'F');

            const normalize = s => s.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
            const completedStatusKeys = customStatuses.filter(s => {
                const name = normalize(s.name);
                return name.includes('concluido') || name.includes('finalizado') || name.includes('completo');
            }).map(s => s.key);

            const completedItems = currentService.items.filter(item => 
                completedStatusKeys.includes(item.status)
            ).length;

            const progress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;

            }
            
            // ===== FOOTER =====
            doc.setDrawColor(226, 232, 240);
            doc.setLineWidth(0.5);
            doc.line(20, 270, 190, 270);
            
            // Salvar PDF
            doc.save(`${currentService.name.replace(/[^a-zA-Z0-9]/g, '_')}_relatorio.pdf`);
            showNotification('Relat√≥rio PDF exportado com sucesso!', 'success');
        }

        // Data management
        function exportData() {
            const data = {
                messages,
                services,
                copyHistory,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Backup exportado com sucesso!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.messages) {
                        messages = data.messages;
                        localStorage.setItem('messages', JSON.stringify(messages));
                    }
                    
                    if (data.services) {
                        services = data.services;
                        localStorage.setItem('services', JSON.stringify(services));
                    }
                    
                    if (data.copyHistory) {
                        copyHistory = data.copyHistory;
                        localStorage.setItem('copyHistory', JSON.stringify(copyHistory));
                    }
                    
                    updateMessageStats();
                    renderMessages();
                    updateTagFilter();
                    renderCopyHistory();
                    updateServiceStats();
                    renderServices();
                    
                    showNotification('Dados restaurados com sucesso!', 'success');
                } catch (error) {
                    showNotification('Erro ao importar dados', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Notifications
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            
            const colors = {
                success: 'from-blue-500 to-blue-600',
                error: 'from-red-500 to-red-600',
                info: 'from-blue-600 to-blue-700'
            };
            
            const icons = {
                success: 'check-circle',
                error: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.className = `notification bg-gradient-to-r ${colors[type]} text-white px-6 py-4 rounded-xl shadow-lg flex items-center space-x-3 border border-white/20`;
            notification.innerHTML = `
                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-${icons[type]} text-sm"></i>
                </div>
                <span class="font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-auto w-6 h-6 bg-white/20 rounded-lg flex items-center justify-center hover:bg-white/30 transition-colors">
                    <i class="fas fa-times text-xs"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Initialize sample data - removed to start with clean system

        // Initialize everything
        updateMessageStats();
        renderMessages();
        updateTagFilter();
        renderCopyHistory();
        updateServiceStats();
        renderServices();
    </script>
</body>
</html>
